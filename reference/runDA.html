<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Test for differential abundance using edgeR — runDA • treeclimbR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Test for differential abundance using edgeR — runDA"><meta property="og:description" content="Test for differential abundance of entities using functions from
the edgeR package. This adapts edgerWrp to
accept input as a
TreeSummarizedExperiment
(TSE) object instead of a matrix. Features could be
represented in either rows or columns. By default, features are in the rows.
Then, samples are in columns and the sample information is in colData.
The tree that stores the hierarchical information about features is in
rowTree. Each row of the assays can be mapped to a node of
the tree. Data on rows that are mapped to internal nodes is generated from
data on leaf nodes. Normalization for samples is automatically performed by
edgeR and the library size is calculated using features that
are mapped to leaf nodes."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">treeclimbR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/treeclimbR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/csoneson/treeclimbR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test for differential abundance using edgeR</h1>
    <small class="dont-index">Source: <a href="https://github.com/csoneson/treeclimbR/blob/HEAD/R/runDA.R" class="external-link"><code>R/runDA.R</code></a></small>
    <div class="hidden name"><code>runDA.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Test for differential abundance of entities using functions from
the <code>edgeR</code> package. This adapts <code><a href="edgerWrp.html">edgerWrp</a></code> to
accept input as a
<code><a href="https://rdrr.io/pkg/TreeSummarizedExperiment/man/TreeSummarizedExperiment-constructor.html" class="external-link">TreeSummarizedExperiment</a></code>
(TSE) object instead of a <code>matrix</code>. Features could be
represented in either rows or columns. By default, features are in the rows.
Then, samples are in columns and the sample information is in <code>colData</code>.
The tree that stores the hierarchical information about features is in
<code>rowTree</code>. Each row of the <code>assays</code> can be mapped to a node of
the tree. Data on rows that are mapped to internal nodes is generated from
data on leaf nodes. Normalization for samples is automatically performed by
<code>edgeR</code> and the library size is calculated using features that
are mapped to leaf nodes.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runDA</span><span class="op">(</span></span>
<span>  <span class="va">TSE</span>,</span>
<span>  feature_on_row <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  option <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"glmQL"</span><span class="op">)</span>,</span>
<span>  design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contrast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_min_count <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  filter_min_total_count <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  filter_large_n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  filter_min_prop <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  normalize_method <span class="op">=</span> <span class="st">"TMM"</span>,</span>
<span>  group_column <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  design_terms <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>TSE</dt>
<dd><p>A <code>TreeSummarizedExperiment</code> object.</p></dd>


<dt>feature_on_row</dt>
<dd><p>A logical scalar. If <code>TRUE</code> (default),
features or entities (e.g. genes, OTUs) are in rows of the <code>assays</code>
tables, and samples are in columns; otherwise, it's the other way around.</p></dd>


<dt>assay</dt>
<dd><p>A numeric index or assay name to specify which assay from
<code>assays</code> is used for analysis.</p></dd>


<dt>option</dt>
<dd><p>Either <code>"glm"</code> or <code>"glmQL"</code>. If <code>"glm"</code>,
<code><a href="https://rdrr.io/pkg/edgeR/man/glmfit.html" class="external-link">glmFit</a></code> and <code><a href="https://rdrr.io/pkg/edgeR/man/glmLRT.html" class="external-link">glmLRT</a></code> are used;
otherwise, <code><a href="https://rdrr.io/pkg/edgeR/man/glmQLFit.html" class="external-link">glmQLFit</a></code> and
<code><a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFTest</a></code> are used. Details about the difference
between two options are in the help page of
<code><a href="https://rdrr.io/pkg/edgeR/man/glmQLFit.html" class="external-link">glmQLFit</a></code>.</p></dd>


<dt>design</dt>
<dd><p>A numeric design matrix. If <code>NULL</code>, all columns of
the sample annotation will be used to create the design matrix.</p></dd>


<dt>contrast</dt>
<dd><p>A numeric vector specifying one contrast of
the linear model coefficients to be tested equal to zero. Its length
must equal to the number of columns of design. If <code>NULL</code>, the last
coefficient will be tested equal to zero.</p></dd>


<dt>filter_min_count</dt>
<dd><p>A numeric value, passed to <strong>min.count</strong> of
<code><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></code>.</p></dd>


<dt>filter_min_total_count</dt>
<dd><p>A numeric value, passed to
<strong>min.total.count</strong> of <code><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></code>.</p></dd>


<dt>filter_large_n</dt>
<dd><p>A numeric value, passed to <strong>large.n</strong> of
<code><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></code>.</p></dd>


<dt>filter_min_prop</dt>
<dd><p>A numeric value, passed to <strong>min.prop</strong> of
<code><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></code>.</p></dd>


<dt>normalize</dt>
<dd><p>A logical scalar indicating whether to estimate
normalization factors (using <code><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></code>).</p></dd>


<dt>normalize_method</dt>
<dd><p>Normalization method to be used. See
<code><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></code> for more details.</p></dd>


<dt>group_column</dt>
<dd><p>The name of the column in the sample annotation
providing group labels for samples (currently not used).</p></dd>


<dt>design_terms</dt>
<dd><p>The names of columns from the sample annotation
that will be used to generate the design matrix. This is ignored if
<strong>design</strong> is provided.</p></dd>


<dt>...</dt>
<dd><p>More arguments to pass to <code><a href="https://rdrr.io/pkg/edgeR/man/glmfit.html" class="external-link">glmFit</a></code>
(<code>option = "glm"</code> or <code><a href="https://rdrr.io/pkg/edgeR/man/glmQLFit.html" class="external-link">glmQLFit</a></code>
(<code>option = "glmQL"</code>).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with entries <strong>edgeR_results</strong>, <strong>tree</strong>, and
<strong>nodes_drop</strong>.</p><dl><dt>edgeR_results</dt>
<dd><p>The output of <code><a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFTest</a></code> or
         <code><a href="https://rdrr.io/pkg/edgeR/man/glmLRT.html" class="external-link">glmLRT</a></code> depending on the specified
         <code>option</code>.</p></dd>

    <dt>tree</dt>
<dd><p>The hierarchical structure of entities that was stored in the
         input <code>TSE</code>.</p></dd>

    <dt>nodes_drop</dt>
<dd><p>A vector storing the alias node labels of entities
         that are filtered before analysis due to low counts.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The experimental design is specified by a design matrix and provided
via the argument <code>design</code>. More details about the calculation of
normalization factor could be found from
<code><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></code>.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Ruizhu Huang</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TreeSummarizedExperiment</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load example data set</span></span></span>
<span class="r-in"><span><span class="va">lse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"da_sim_100_30_18de.rds"</span>,</span></span>
<span class="r-in"><span>                           package <span class="op">=</span> <span class="st">"treeclimbR"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Aggregate counts on internal nodes</span></span></span>
<span class="r-in"><span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TreeSummarizedExperiment/man/showNode.html" class="external-link">showNode</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tinyTree</span>, only.leaf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TreeSummarizedExperiment/man/aggTSE.html" class="external-link">aggTSE</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lse</span>, rowLevel <span class="op">=</span> <span class="va">nodes</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">runDA</span><span class="op">(</span>TSE <span class="op">=</span> <span class="va">tse</span>, feature_on_row <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>             assay <span class="op">=</span> <span class="fl">1</span>, option <span class="op">=</span> <span class="st">"glmQL"</span>,</span></span>
<span class="r-in"><span>             design <span class="op">=</span> <span class="va">dd</span>, contrast <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>             normalize <span class="op">=</span> <span class="cn">TRUE</span>, filter_min_count <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "edgeR_results" "nodes_drop"    "tree"         </span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">nodes_drop</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "alias_1"  "alias_8"  "alias_12" "alias_18"</span>
<span class="r-in"><span><span class="fu">edgeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/topTags.html" class="external-link">topTags</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">edgeR_results</span>, sort.by <span class="op">=</span> <span class="st">"PValue"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficient:  groupB </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               logFC   logCPM          F       PValue          FDR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_16  1.0495027 16.09379 28.5197981 8.990791e-07 1.348619e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_5   0.7612075 15.55706  9.3384468 3.053676e-03 2.290257e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_6   0.6590408 15.67131  8.3208019 5.053906e-03 2.526953e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_15 -0.1537974 16.64917  0.7531299 3.881545e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_9  -0.1541389 16.97145  0.6738491 4.142135e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_7  -0.1538470 16.69156  0.6660846 4.169097e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_4  -0.1534741 16.41854  0.6368260 4.272918e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_10 -0.1539048 16.75636  0.6343946 4.281688e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_17 -0.1537167 16.60601  0.6292017 4.300602e-01 6.128417e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alias_19 -0.1534741 16.43653  0.5456333 4.623302e-01 6.128417e-01</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ruizhu Huang, Charlotte Soneson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

